// Django Ajax Post
// A plugin to overlay the page whilst posting via AJAX to Django server
// version 1.0, Nov. 2015
// by Tom Symonds
!function(e){e.djangoAjaxPost=function(t,s){var a={postUrl:"",postData:"",overlayMessage:"Requesting...",overlaySuccess:"Success",overlayGif:"img/loading.gif",successMessage:"Thank you.",prependOverlayTo:"body",initalDelay:800,successDelay:300},n=this;n.settings={};var i=e(t),t=t;n.init=function(){if(n.settings=e.extend({},a,s),0==e("#overlay").length){var t='<div class="ajaxOverlay"><div><img src="'+n.settings.overlayGif+'"/><span class="ajaxOverlayText">'+n.settings.overlayMessage+"</span></div></div>",o=e(t);o.prependTo(e(n.settings.prependOverlayTo))}e.ajaxSetup({beforeSend:function(e,t){function s(e){var t=null;if(document.cookie&&""!=document.cookie)for(var s=document.cookie.split(";"),a=0;a<s.length;a++){var n=jQuery.trim(s[a]);if(n.substring(0,e.length+1)==e+"="){t=decodeURIComponent(n.substring(e.length+1));break}}return t}/^http:.*/.test(t.url)||/^https:.*/.test(t.url)||e.setRequestHeader("X-CSRFToken",s("csrftoken"))}}),e.ajax({url:n.settings.postUrl,data:n.settings.postData,type:"POST",success:function(t){setTimeout(function(){e(".ajaxOverlayText").text(n.settings.overlaySuccess),setTimeout(function(){o.hide(),i.after(n.settings.successMessage),i.hide()},n.settings.successDelay)},n.settings.initalDelay)},error:function(e,t,s){console.log(e.status+": "+e.responseText)}})},n.init()},e.fn.djangoAjaxPost=function(t){return this.each(function(){if(void 0==e(this).data("djangoAjaxPost")){var s=new e.djangoAjaxPost(this,t);e(this).data("djangoAjaxPost",s)}})}}(jQuery);